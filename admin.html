<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Moderator Dashboard</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
button { margin-right: 5px; padding: 5px 10px; cursor: pointer; }
.approved { background-color: #c8e6c9; }
.denied { background-color: #ffcdd2; }
</style>
</head>
<body>

<h1>Moderator Dashboard</h1>
<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Date</th>
      <th>Time</th>
      <th>Location</th>
      <th>Description</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="eventTableBody"></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async function() {

  // 1) Initialize Supabase
  const SUPABASE_URL = "PASTE_YOUR_SUPABASE_URL_HERE";
  const SUPABASE_ANON_KEY = "PASTE_YOUR_ANON_KEY_HERE";
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const tableBody = document.getElementById("eventTableBody");

  // 2) Load pending events
  async function loadPendingEvents() {
    tableBody.innerHTML = '';
    try {
      const { data: events, error } = await supabaseClient
        .from("events")
        .select("*")
        .eq("status", "pending")
        .order("created_at", { ascending: true });

      if (error) throw error;
      events.forEach(ev => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${ev.title}</td>
          <td>${ev.date}</td>
          <td>${ev.time || ''}</td>
          <td>${ev.location || ''}</td>
          <td>${ev.description || ''}</td>
          <td>
            <button data-id="${ev.id}" class="approve">Approve</button>
            <button data-id="${ev.id}" class="deny">Deny</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      // Attach event listeners
      document.querySelectorAll(".approve").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          await supabaseClient.from("events").update({status:"approved"}).eq("id", id);
          loadPendingEvents();
        };
      });
      document.querySelectorAll(".deny").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          await supabaseClient.from("events").update({status:"denied"}).eq("id", id);
          loadPendingEvents();
        };
      });

    } catch(err) {
      console.error(err);
      alert("Failed to load events");
    }
  }

  loadPendingEvents();
});
</script>

</body>
</html>
